## SSH 安装使用

#### 一、SSH 安装与配置

1. 打开“设置”，选择“应用”>“应用和功能”，然后选择“可选功能” 。

   ![image-20230219185921204](https://img2023.cnblogs.com/blog/2213660/202302/2213660-20230219185931689-616594515.png)

2. 选择"添加功能"，安装 "OpenSSH 客户端" 和 "OpenSSH服务器"

   ![image-20230219190059054](https://img2023.cnblogs.com/blog/2213660/202302/2213660-20230219190106780-1497070608.png)

3. 打开 "Windows 安全中心" > "防火墙和网络保护" > "高级设置"

   ![image-20230219190359970](https://img2023.cnblogs.com/blog/2213660/202302/2213660-20230219190407874-1628333104.png)

4. 新建入站规则

   ![image-20230219190522230](https://img2023.cnblogs.com/blog/2213660/202302/2213660-20230219190530074-1104201198.png)

5. 选择 "端口" > "TCP" > "特色本地端口:" 22 > "允许连接" > "设置名称"

   ![image-20230219190805108](https://img2023.cnblogs.com/blog/2213660/202302/2213660-20230219190812823-2062083359.png)

6. 打开 "任务管理器" > "服务"，找到 "sshd"

   ![image-20230219190954920](https://img2023.cnblogs.com/blog/2213660/202302/2213660-20230219191002821-1200781464.png)

7. 右击，选择打开服务，找到 "OpenSSH SSH Server"

   ![image-20230219191058938](https://img2023.cnblogs.com/blog/2213660/202302/2213660-20230219191106744-794575519.png)

8. 右击，选择属性，将启动类型改为 "自动"， 将服务状态改为启动

   ![image-20230219191210554](https://img2023.cnblogs.com/blog/2213660/202302/2213660-20230219191218345-2024041463.png)

SSH 配置完成



#### 二、OpenSSH 连接

1. 打开终端，使用命令 `ssh username@servername` 连接，如 `ssh root@127.0.0.1`
2. 然后会提示输入密码，密码输入时为不可见
3. 最后完成连接



#### 三、SSH 公钥连接(免密连接)

> ssh客户端主机配置

1. 生成 SSH key: 打开终端, 输入 `ssh-keygen -t rsa` (指定rsa算法生成密钥), 接着三个回车键，然后就会生成两个文件 id_rsa （密钥）和 id_rsa.pub （公钥）

2. win+r打开 "运行"，输入 `%USERPROFILE%/.ssh` 打开密钥默认生成的文件夹

   ![image-20230219193427905](https://img2023.cnblogs.com/blog/2213660/202302/2213660-20230219193435955-78314928.png)




> ssh服务端主机配置

1. win+r打开 "运行"，输入 `%programdata%/ssh` 打开OpenSSH的配置文件夹

   ![image-20230219191822319](https://img2023.cnblogs.com/blog/2213660/202302/2213660-20230219191830218-625513203.png)

2. 在文件夹中打开 "sshd_config" 配置文件，在文件末尾加入下面条件

   ```shell
   PubkeyAuthentication yes            # 是否可用公钥方式验证
   ```

   ![image-20230219192240020](https://img2023.cnblogs.com/blog/2213660/202302/2213660-20230219192247908-1242456638.png)

3. 打开服务，找到 "sshd", 将其 "重新启动"，ssh服务端配置完成

4. 将客户端上的 `id_rsa.pub` 上传到 服务器主机上，并将其中的密钥按以下规则复制到对应文件中

   - 如果要连接的用户为**标准用户**，将密钥内容复制到 **%USERPROFILE%/.ssh** 文件夹下的 **authorized_keys** 文件中 
   - 如果要连接的用户为**管理用户**，将密钥内容复制到 **%programdata%/ssh** 文件夹下的 **administrators_authorized_keys** 文件中 
   - **文件不存在就新建一个，如果有多个用户，一行一个用户的密钥**

5. 这时候再尝试使用命令 `ssh username@servername` 连接，直接连接成功，不需要输入密码







